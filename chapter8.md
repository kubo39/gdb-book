# core dump

はじめにcoreを生成できるように準備しておく。

```console
$ ulimit -c
0
$ ulimit -S -c unlimited
$ ulimit -c
unlimited
```

coreを試すために、わざとSEGVを起こすようなプログラムを書く。

```d
void main()
{
    int* p;
    *p = 42;
}
```

デバッグオプションつきでバイナリを生成し、実行してみる。

```console
$ dmd -g segv.d
$ ./segv
Segmentation fault (core dumped)
```

coreが吐かれている場所を確認する。WSL2だと素のUbuntuと違うので注意([apport](https://wiki.ubuntu.com/Apport)が使えなかったりとか)。

```console
$ cat /proc/sys/kernel/core_pattern
/mnt/wslg/dumps/core.%e
$ file /mnt/wslg/dumps/core.segv.20508
/mnt/wslg/dumps/core.segv.20508: ELF 64-bit LSB core file, x86-64, version 1 (SYSV), SVR4-style, from './segv', real uid: 1000, effective uid: 1000, real gid: 1000, effective gid: 1000, execfn: './segv', platform: 'x86_64'
```

実行バイナリをcoreつきでgdbに渡してみる。

```console
$ gdb -q ./segv /mnt/wslg/dumps/core.segv.20508
Reading symbols from ./segv...
[New LWP 20508]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `./segv'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  _Dmain () at ./segv.d:4
4           *p = 42;
```
