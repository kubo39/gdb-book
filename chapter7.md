# Tips

ここではtopicとして扱うには少々小さいテーマをまとめてTipsとして紹介する。

## `set confirm off`

CI環境でGDBを動かしたいときなどに使うことがある。

```console
$ gdb -n -ex 'set confirm off' -ex run -ex 'bt full' -ex q ./a.out
```

## debug expr

そこまで使う機会が多くはないが、GDBのdebug expressionの機能もD言語に対応している。

意図的にSEGVを起こすコードで試してみる。

```d
void main()
{
    int* tmp;
    *tmp = 42;
}
```

`set debug expression 1` を指定すると通常よりも情報量の多い出力が得られる。

```console
(gdb) set debug expression 1
(gdb) r
Starting program: /home/kubo39/dev/dlang/gdb-book/segv
[Switching to thread 1 (process 14985)](running)
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Dump of expression @ 0x55d16d828ee0, before conversion to prefix form:
	Language d, 8 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4             BINOP_LSH  7  ................
	    5  <unknown 1667197299>  28539402219121011  si_code.........
	    6             BINOP_LSH  7  ................
	    7       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d828ee0, after conversion to prefix form:
Expression: `$_siginfo.si_code'
	Language d, 8 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `si_code'
	    5    OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d8f5a10, before conversion to prefix form:
	Language d, 23 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..m.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14     BINOP_LOGICAL_AND  9  ................
	   15  <unknown 1684300127>  7954024836804927839  _addr_bnd.......
	   16     BINOP_LOGICAL_AND  9  ................
	   17       STRUCTOP_STRUCT  82  R...............
	   18       STRUCTOP_STRUCT  82  R...............
	   19             BINOP_MOD  6  ................
	   20  <unknown 2003790943>  125780121054303  _lower...~.l.U..
	   21             BINOP_MOD  6  ................
	   22       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d8f5a10, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault._addr_bnd._lower'
	Language d, 23 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `_lower'
	    5    STRUCTOP_STRUCT       Element name: `_addr_bnd'
	   10      STRUCTOP_STRUCT       Element name: `_sigfault'
	   15        STRUCTOP_STRUCT       Element name: `_sifields'
	   20          OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d5ef060, before conversion to prefix form:
	Language d, 23 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..m.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14     BINOP_LOGICAL_AND  9  ................
	   15  <unknown 1684300127>  7954024836804927839  _addr_bnd.......
	   16     BINOP_LOGICAL_AND  9  ................
	   17       STRUCTOP_STRUCT  82  R...............
	   18       STRUCTOP_STRUCT  82  R...............
	   19             BINOP_MOD  6  ................
	   20  <unknown 1886418271>  125780003681631  _upper...~.l.U..
	   21             BINOP_MOD  6  ................
	   22       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d5ef060, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault._addr_bnd._upper'
	Language d, 23 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `_upper'
	    5    STRUCTOP_STRUCT       Element name: `_addr_bnd'
	   10      STRUCTOP_STRUCT       Element name: `_sigfault'
	   15        STRUCTOP_STRUCT       Element name: `_sifields'
	   20          OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d6082f0, before conversion to prefix form:
	Language d, 18 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..m.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14             BINOP_LSH  7  ................
	   15  <unknown 1633642867>  32198529638164851  si_addr..0a._j3.
	   16             BINOP_LSH  7  ................
	   17       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d6082f0, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault.si_addr'
	Language d, 18 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `si_addr'
	    5    STRUCTOP_STRUCT       Element name: `_sigfault'
	   10      STRUCTOP_STRUCT       Element name: `_sifields'
	   15        OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)

ProgramDump of expression @ 0x55d16d4827b0, before conversion to prefix form:
	Language d, 8 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4             BINOP_LSH  7  ................
	    5  <unknown 1667197299>  28539402219121011  si_code.s..m.U..
	    6             BINOP_LSH  7  ................
	    7       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d4827b0, after conversion to prefix form:
Expression: `$_siginfo.si_code'
	Language d, 8 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `si_code'
	    5    OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d5afbc0, before conversion to prefix form:
	Language d, 23 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..l.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14     BINOP_LOGICAL_AND  9  ................
	   15  <unknown 1684300127>  7954024836804927839  _addr_bnd..l.U..
	   16     BINOP_LOGICAL_AND  9  ................
	   17       STRUCTOP_STRUCT  82  R...............
	   18       STRUCTOP_STRUCT  82  R...............
	   19             BINOP_MOD  6  ................
	   20  <unknown 2003790943>  125780121054303  _lower..........
	   21             BINOP_MOD  6  ................
	   22       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d5afbc0, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault._addr_bnd._lower'
	Language d, 23 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `_lower'
	    5    STRUCTOP_STRUCT       Element name: `_addr_bnd'
	   10      STRUCTOP_STRUCT       Element name: `_sigfault'
	   15        STRUCTOP_STRUCT       Element name: `_sifields'
	   20          OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d5c2040, before conversion to prefix form:
	Language d, 23 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..l.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14     BINOP_LOGICAL_AND  9  ................
	   15  <unknown 1684300127>  7954024836804927839  _addr_bnd.......
	   16     BINOP_LOGICAL_AND  9  ................
	   17       STRUCTOP_STRUCT  82  R...............
	   18       STRUCTOP_STRUCT  82  R...............
	   19             BINOP_MOD  6  ................
	   20  <unknown 1886418271>  125780003681631  _upper...~.l.U..
	   21             BINOP_MOD  6  ................
	   22       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d5c2040, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault._addr_bnd._upper'
	Language d, 23 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `_upper'
	    5    STRUCTOP_STRUCT       Element name: `_addr_bnd'
	   10      STRUCTOP_STRUCT       Element name: `_sigfault'
	   15        STRUCTOP_STRUCT       Element name: `_sifields'
	   20          OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
Dump of expression @ 0x55d16d855ad0, before conversion to prefix form:
	Language d, 18 elements, 16 bytes each.
	Index                Opcode         Hex Value  String Value
	    0        OP_INTERNALVAR  45  -...............
	    1  <unknown 1832437216>  94357968963040  ..8m.U..........
	    2        OP_INTERNALVAR  45  -...............
	    3       STRUCTOP_STRUCT  82  R...............
	    4     BINOP_LOGICAL_AND  9  ................
	    5  <unknown 1718186847>  7236270204641702751  _sifields..l.U..
	    6     BINOP_LOGICAL_AND  9  ................
	    7       STRUCTOP_STRUCT  82  R...............
	    8       STRUCTOP_STRUCT  82  R...............
	    9     BINOP_LOGICAL_AND  9  ................
	   10  <unknown 1734964063>  7815259820820886367  _sigfault.......
	   11     BINOP_LOGICAL_AND  9  ................
	   12       STRUCTOP_STRUCT  82  R...............
	   13       STRUCTOP_STRUCT  82  R...............
	   14             BINOP_LSH  7  ................
	   15  <unknown 1633642867>  32198529638164851  si_addr.........
	   16             BINOP_LSH  7  ................
	   17       STRUCTOP_STRUCT  82  R...............
Dump of expression @ 0x55d16d855ad0, after conversion to prefix form:
Expression: `$_siginfo._sifields._sigfault.si_addr'
	Language d, 18 elements, 16 bytes each.
	    0  STRUCTOP_STRUCT       Element name: `si_addr'
	    5    STRUCTOP_STRUCT       Element name: `_sigfault'
	   10      STRUCTOP_STRUCT       Element name: `_sifields'
	   15        OP_INTERNALVAR        Internal var @0x55d16d38c5e0 (_siginfo)
 received signal SIGSEGV, Segmentation fault.
D main () at segv.d:4
4	    *tmp = 42;
```
